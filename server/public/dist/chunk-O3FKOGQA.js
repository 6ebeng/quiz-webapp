import{a as Y}from"./chunk-6UJPAVCL.js";import{$ as c,Cb as X,D as f,Da as x,E as g,La as D,Ma as A,Q as N,Qa as G,S as l,V as y,Y as U,Z as I,_a as M,a as T,ab as Q,b as k,ba as s,bb as F,da as r,db as K,ea as o,eb as q,fa as m,fb as O,ga as w,gb as L,ha as _,hb as B,ia as u,ja as h,ka as V,kb as b,la as j,ma as R,mb as $,na as v,oa as p,ob as H,pa as E,qa as z,qb as J,xb as W,y as S}from"./chunk-3B37LIQD.js";var re=["fileInput"];function oe(e,a){e&1&&(r(0,"div",28),p(1),o()),e&2&&(l(),z(" ","File size limit exceeded"," "))}function le(e,a){if(e&1&&m(0,"input",29),e&2){let t=u();h("placeholder",t.user.username)}}function ae(e,a){e&1&&m(0,"input",30)}function me(e,a){if(e&1&&m(0,"input",29),e&2){let t=u();h("placeholder",t.user.name)}}function se(e,a){e&1&&m(0,"input",31)}function pe(e,a){if(e&1&&m(0,"input",29),e&2){let t=u();h("placeholder",t.user.surname)}}function ce(e,a){e&1&&m(0,"input",32)}function de(e,a){if(e&1&&m(0,"input",29),e&2){let t=u();h("placeholder",t.user.age)}}function ue(e,a){e&1&&m(0,"input",33)}function fe(e,a){if(e&1&&m(0,"input",29),e&2){let t=u();h("placeholder",t.user.email)}}function ge(e,a){if(e&1&&(r(0,"li",37),p(1),o()),e&2){let t=a.$implicit;l(),E(t)}}function _e(e,a){if(e&1&&(r(0,"ul"),c(1,ge,2,1,"li",36),o()),e&2){let t=u(2);l(),s("ngForOf",t.getErrorMessages(t.profileForm.get("email")))}}function he(e,a){if(e&1&&(m(0,"input",34),c(1,_e,2,1,"ul",35)),e&2){let t,n=u();l(),s("ngIf",((t=n.profileForm.get("email"))==null?null:t.invalid)&&((t=n.profileForm.get("email"))==null?null:t.dirty))}}function ve(e,a){if(e&1){let t=w();r(0,"button",38),_("click",function(){f(t);let i=u();return g(i.onCancel())}),p(1,"Cancel"),o()}}var ee=(()=>{class e{constructor(t,n,i){this.authService=t,this.fb=n,this.validatorService=i,this.authenticated=!1,this.authSubscription=null,this.user=new Q,this.userSubscription=null,this.edit=!1,this.imgDir=F.API_URL+"/assets/uploads/",this.defaultImg=F.API_URL+"/assets/img/avatar.png",this.maxSize=!1}ngOnInit(){this.authSubscription=this.authService.authStatus.subscribe(t=>{this.authenticated=t}),this.userSubscription=this.authService.getUser().subscribe(t=>{this.user=t}),this.initForm()}initForm(){this.profileForm=this.fb.group({username:new b({value:this.user.username,disabled:!0},null),name:new b(this.user.name,null),surname:new b(this.user.surname,null),age:new b(this.user.age,null),email:new b(this.user.email,[O.required,O.email])})}getErrorMessages(t,n){return this.validatorService.generateErrorMsgs(t,n)}onEdit(){if(this.edit){let t=k(T({},this.profileForm.value),{id:this.user.id,username:this.user.username,password:this.user.password,role:this.user.role,imageUrl:this.user.imageUrl});this.authService.editUser(t).subscribe({next:n=>{n==="OK"&&this.authService.restoreUser(t)},error:n=>{console.error(n)}})}this.edit=!this.edit}onCancel(){this.edit=!this.edit,this.initForm()}openFileInput(){this.fileInput.nativeElement.click()}onFileSelected(t){let n=t.target.files[0];console.log(n),n&&n.size<200*1024?(this.maxSize=!1,this.authService.editProfileImg(this.user.id,n).subscribe({next:i=>{i==="OK"&&this.authService.restoreUser(this.user)},error:i=>{console.error(i)}})):this.maxSize=!0}removeImage(){this.authService.deleteProfileImg(this.user.id).subscribe({next:t=>{console.log(t),t==="OK"&&this.authService.restoreUser(this.user)},error:t=>{console.error(t)}})}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.userSubscription&&this.userSubscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||e)(y(K),y(W),y(Y))}}static{this.\u0275cmp=U({type:e,selectors:[["app-profile"]],viewQuery:function(n,i){if(n&1&&V(re,5),n&2){let d;j(d=R())&&(i.fileInput=d.first)}},standalone:!1,decls:63,vars:16,consts:[["fileInput",""],["username",""],["name",""],["surname",""],["age",""],["email",""],[1,"container-fluid"],[1,"row","mt-5","justify-content-center"],[1,"col-md-6","col-xs-12","mb-4","mb-md-0","pe-5","text-md-end","text-center"],[1,"d-flex","justify-content-center","justify-content-md-end"],[1,"avatar","text-center"],["alt","profile img",1,"profile-img","img-fluid",3,"src"],["type","file","hidden","","accept","image/*",3,"change"],[1,"btn-group"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-edit","btn-sm","dropdown-toggle"],[1,"fa-solid","fa-pencil","me-1"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"],["class","form-invalid mt-4 me-4",4,"ngIf"],[1,"col-md-6","col-xs-12"],[3,"formGroup"],[1,"form-group","row","mb-1","justify-content-center","justify-content-md-start","align-items-center"],[1,"personal-details","col-3","col-md-2","offset-xs-1","offset-sm-0"],[1,"col-4","col-xxl-3"],["class","form-control rounded custom-control","type","text","disabled","",3,"placeholder",4,"ngIf","ngIfElse"],[1,"form-group","row","justify-content-center","justify-content-md-start"],[1,"btn","btn-sm","mt-2","me-2",3,"click","disabled"],["class","btn btn-sm mt-2",3,"click",4,"ngIf"],[1,"form-invalid","mt-4","me-4"],["type","text","disabled","",1,"form-control","rounded","custom-control",3,"placeholder"],["type","text","formControlName","username",1,"form-control","rounded"],["type","text","formControlName","name",1,"form-control","rounded"],["type","text","formControlName","surname",1,"form-control","rounded"],["type","text","formControlName","age",1,"form-control","rounded"],["type","email","formControlName","email",1,"form-control","rounded"],[4,"ngIf"],["class","form-invalid",4,"ngFor","ngForOf"],[1,"form-invalid"],[1,"btn","btn-sm","mt-2",3,"click"]],template:function(n,i){if(n&1){let d=w();r(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9)(4,"div",10),m(5,"img",11),o(),r(6,"input",12,0),_("change",function(P){return f(d),g(i.onFileSelected(P))}),o()(),r(8,"div",13)(9,"button",14),m(10,"i",15),o(),r(11,"ul",16)(12,"li")(13,"a",17),_("click",function(){return f(d),g(i.openFileInput())}),p(14,"Select image"),o()(),r(15,"li")(16,"a",17),_("click",function(){return f(d),g(i.removeImage())}),p(17,"Remove image"),o()()()(),r(18,"div",9),c(19,oe,2,1,"div",18),o()(),r(20,"div",19)(21,"form",20)(22,"div",21)(23,"div",22),p(24,"Username:"),o(),r(25,"div",23),c(26,le,1,1,"input",24)(27,ae,1,0,"ng-template",null,1,x),o()(),r(29,"div",21)(30,"div",22),p(31,"Name:"),o(),r(32,"div",23),c(33,me,1,1,"input",24)(34,se,1,0,"ng-template",null,2,x),o()(),r(36,"div",21)(37,"div",22),p(38,"Surname:"),o(),r(39,"div",23),c(40,pe,1,1,"input",24)(41,ce,1,0,"ng-template",null,3,x),o()(),r(43,"div",21)(44,"div",22),p(45,"Age:"),o(),r(46,"div",23),c(47,de,1,1,"input",24)(48,ue,1,0,"ng-template",null,4,x),o()(),r(50,"div",21)(51,"div",22),p(52,"E-mail:"),o(),r(53,"div",23),c(54,fe,1,1,"input",24)(55,he,2,1,"ng-template",null,5,x),o()(),r(57,"div",25),m(58,"div",22),r(59,"div",23)(60,"button",26),_("click",function(){return f(d),g(i.onEdit())}),p(61),o(),c(62,ve,2,0,"button",27),o()()()()()()}if(n&2){let d=v(28),C=v(35),P=v(42),ie=v(49),ne=v(56);l(5),s("src",i.user.imageUrl?i.imgDir+i.user.imageUrl:i.defaultImg,N),l(14),s("ngIf",i.maxSize),l(2),s("formGroup",i.profileForm),l(5),s("ngIf",!i.edit)("ngIfElse",d),l(7),s("ngIf",!i.edit)("ngIfElse",C),l(7),s("ngIf",!i.edit)("ngIfElse",P),l(7),s("ngIf",!i.edit)("ngIfElse",ie),l(7),s("ngIf",!i.edit)("ngIfElse",ne),l(6),s("disabled",i.edit&&!i.profileForm.valid),l(),E(i.edit?"Save":"Edit profile"),l(),s("ngIf",i.edit)}},dependencies:[D,A,$,q,L,B,H,J],styles:[".personal-details[_ngcontent-%COMP%]{padding-right:0}input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%]{margin:0;font-size:1em;padding:2px 4px}.custom-control[_ngcontent-%COMP%]:disabled{background-color:#fff;border:1px solid transparent}.btn[_ngcontent-%COMP%]{font-size:.9em;border:1px solid silver;background-color:#f5f5f5}.btn[_ngcontent-%COMP%]:hover{background-color:#dcdcdc}.btn-edit[_ngcontent-%COMP%]{min-width:50px;padding:2px;border-radius:6px;background-color:#f5f5f5}.dropdown-menu[_ngcontent-%COMP%], .dropdown-item[_ngcontent-%COMP%]{font-size:.9em;padding:2px 4px}.dropdown-menu[_ngcontent-%COMP%]{min-width:120px!important}.dropdown-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:active{color:initial;background-color:#e6e6e6}.dropdown-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{cursor:pointer}.form-invalid[_ngcontent-%COMP%]{color:#eb0000}.profile-img[_ngcontent-%COMP%]{display:block;overflow:hidden;width:100px;height:100px;padding:5px;border:1px solid lightgray;border-radius:6px}.btn-group[_ngcontent-%COMP%]{position:relative;top:-20px;left:-55px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}"]})}}return e})();var xe=[{path:"",component:ee}],te=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=I({type:e})}static{this.\u0275inj=S({imports:[M.forChild(xe),M]})}}return e})();var Re=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=I({type:e})}static{this.\u0275inj=S({imports:[G,te,X]})}}return e})();export{Re as a};
